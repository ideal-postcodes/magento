<?php
$helper = $this->helper('Idealpostcodes\Ukaddresssearch\Helper\Data');
$script = '
console.log("should be here");
document.addEventListener(\'DOMContentLoaded\', function() {
  var apiKey = "' . $helper->getConfig('api_key') . '";
  var postcodeLookup = ' . $helper->getConfig('postcodeLookup') . ';
  var autocomplete = ' . $helper->getConfig('addressAutocomplete') . ';
  var removeOrganisation = ' . $helper->getConfig('removeOrganisation') . ';
  var hoistCountry = ' . $helper->getConfig('hoistCountryField') . ';
  var populateCounty = ' . $helper->getConfig('requireCounty') . ';
  var autocompleteOverride = ' . $helper->getConfig('autocompleteOverride') . ';
  var postcodeLookupOverride = ' . $helper->getConfig('postcodeLookupOverride') . ';
  var enabled = ' . $helper->getConfig('enabled') . ';
  var customFields = ' . trim(preg_replace("/\r|\n/", "", $helper->getConfig('customFields'))) . ';
  // Exit early if disabled
  if (enabled === false) return;
  window.idpcConfig = {
    apiKey: apiKey,
    postcodeLookup: postcodeLookup,
    autocomplete: autocomplete,
    populateCounty: populateCounty,
    removeOrganisation: removeOrganisation,
    hoistCountry: hoistCountry,
    autocompleteOverride: autocompleteOverride,
    postcodeLookupOverride: postcodeLookupOverride,
    customFields: customFields
  };
  window.idpcStart();
});
';
?>
<?= /* @noEscape */ $secureRenderer->renderTag('script', ['type' => 'text/javascript', 'id' => 'idpc-config'], $script, false); ?>
