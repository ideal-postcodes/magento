<?php /** @var Magento\Framework\View\TemplateEngine\Php $this */

$helper = $this->helper('Idealpostcodes\Ukaddresssearch\Helper\Data'); ?>

<?php
$script = '
document.addEventListener(\'DOMContentLoaded\', function() {
  var apiKey = "' . $helper->getConfig('api_key') . '";
  var postcodeLookup = ' . $helper->getConfig('postcodeLookup') . ';
  var autocomplete = ' . $helper->getConfig('addressAutocomplete') . ';
  var populateOrganisation = ' . $helper->getConfig('populateOrganisation') . ';
  var hoistCountry = ' . $helper->getConfig('hoistCountryField') . ';
  var populateCounty = ' . $helper->getConfig('requireCounty') . ';
  var autocompleteOverride = ' . $helper->getConfig('autocompleteOverride') . ';
  var postcodeLookupOverride = ' . $helper->getConfig('postcodeLookupOverride') . ';
  var enabled = ' . $helper->getConfig('enabled') . ';
  var customFields = ' . trim(preg_replace("/\r|\n/", "", $helper->getConfig('customFields'))) . ';
  // Exit early if disabled
  if (enabled === false) return;
  window.idpcConfig = {
    apiKey: apiKey,
    postcodeLookup: postcodeLookup,
    autocomplete: autocomplete,
    populateCounty: populateCounty,
    populateOrganisation: populateOrganisation,
    hoistCountry: hoistCountry,
    autocompleteOverride: autocompleteOverride,
    postcodeLookupOverride: postcodeLookupOverride,
    customFields: customFields
  };
  window.idpcStart();
});
';
?>
<?= $secureRenderer->renderTag('script', [], $script, false); ?>
